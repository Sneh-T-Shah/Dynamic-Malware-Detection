# Malware Detection Using Dynamic Emulation Reports üöÄ

Welcome to the **Malware Detection Project**! This repository contains our implementation of a **dynamic malware detection model** built using emulation reports. The project leverages API call sequences from emulation logs to accurately classify files as benign or malicious, achieving state-of-the-art metrics. Alongside the model, we provide a **UI** and **API** to submit PE files and detect malware in real time.

---

## üìö **Project Overview**

### **Malware Detection Techniques**
Malware detection typically employs two approaches:  

1. **Static Analysis**: Extracts features from PE files without execution, such as imports and headers.  
2. **Dynamic Analysis**: Monitors behavior during execution in a controlled environment, capturing features like API call sequences, error logs, and return values.

This project focuses on **dynamic analysis**, using **emulation reports** for detecting malware, inspired by the research paper:  
**"[Quo Vadis: Hybrid Machine Learning Meta-Model Based on Contextual and Behavioral Malware Representations](https://dl.acm.org/doi/10.1145/3560830.3563726)."**

---

## üß† **Dataset**
We use the dataset available on Kaggle:  
[**Quo Vadis Malware Emulation Dataset**](https://www.kaggle.com/datasets/dmitrijstrizna/quo-vadis-malware-emulation).

The dataset contains **emulation reports** capturing API call sequences, which serve as the primary feature for our dynamic analysis model.

---

## üìä **Model Architecture and Experiments**

### **Model Architecture**
We trained a Convolutional Neural Network (CNN) using **EfficientNet-B2** as the backbone. Our architecture includes:  
- **Pretrained EfficientNet-B2**: For feature extraction.  
- **Dense Layers**: Three fully connected layers with:
  - **1024 neurons each**
  - **L1 Regularization** to prevent overfitting.  

The model achieves outstanding performance on **test data**:  
- **Accuracy**: `0.9961`  
- **Loss**: `0.2055`  
- **Precision**: `0.9915`  
- **Recall**: `0.9976`  

On **validation data**:  
- **Val Accuracy**: `0.9816`  
- **Val Loss**: `3.5265`  
- **Val Precision**: `0.9711`  
- **Val Recall**: `0.9772`

### **Experiments**
We conducted multiple experiments with different CNN architectures. Almost all configurations achieved **over 98% accuracy on test data**.  
The architecture mentioned above provided the **best trade-off between accuracy and efficiency**, making it our final model choice.

---

## üåü **Features and Capabilities**

1. **Dynamic Malware Detection**:
   - Utilizes **API call sequences** from emulation logs.  
   - Achieves state-of-the-art detection performance.  

2. **UI and API Integration**:
   - Submit PE files via the **UI** or **API** to classify them as benign or malicious.  
   - Real-time results using the trained model.  

3. **Custom Emulation Library**:
   - Currently extracts **API calls** and **API hashes**.  
   - Future enhancements: Add support for **start address**, **return values**, and other features.  

4. **EfficientNet Fine-Tuning**:
   - Fine-tuned EfficientNet-B2 backbone to extract meaningful patterns.  

5. **Contributors**:  
   - **Sneh Shah**  
   - **Niral Shekhat** ([GitHub Profile](https://github.com/wizaard07))  

---

## üñ•Ô∏è **Usage**

### **1. Clone the Repository**
```bash
git clone https://github.com/your-username/malware-detection.git
cd malware-detection
```

### **2. Install Dependencies**
Create a virtual environment and install the required packages:
```bash
pip install -r requirements.txt
```

### **3.  Download Pretrained Weights**
The trained model weights (best_model.weights.h5) can be downloaded from the following Google Drive link:

[**Download Weights File**](https://drive.google.com/file/d/1SzWrcXSonuBUM9CG2IvL0RmT1X5UlERl/view?usp=drive_link)  


After downloading, place the file in the root directory of the project. Ensure the weights file is correctly referenced during model loading.
### **4. Run the API**
Start the API server:
```bash
python api.py
```

### **5. Use the UI**
- Open `upload.html` located in the `templates/` folder in your browser.  
- Upload PE files and view the classification results.

---

## üõ†Ô∏è **Future Work**
- **Enhance Emulation Library**:
  - Add support for **start address**, **return values**, and other features.  

- **Incorporate Static Features**:
  - Combine dynamic and static features to improve detection performance.  

- **Deploy on Cloud**:
  - Host the model and API on a scalable cloud platform.  

---

## üìñ **References**
1. **Research Paper**:  
   [Quo Vadis: Hybrid Machine Learning Meta-Model Based on Contextual and Behavioral Malware Representations](https://dl.acm.org/doi/10.1145/3560830.3563726)
2. **Dataset**:  
   [Quo Vadis Malware Emulation Dataset](https://www.kaggle.com/datasets/dmitrijstrizna/quo-vadis-malware-emulation)

---

## ‚úâÔ∏è **Contact**
For queries, reach out to:  
- **Email**: [snehs5483@gmail.com](mailto:snehs5483@gmail.com)  
- **LinkedIn**: [Sneh Shah](https://www.linkedin.com/in/sneh-shah-b26a9825b/)  

---

<p align="center">
<i>"Detecting malware isn‚Äôt just about algorithms‚Äîit's about safeguarding digital frontiers."</i>
</p>